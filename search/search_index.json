{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Integrations","text":"<p>SCOPD Phishing attack simulator</p> <p>SCOPD DLP</p> <p>VirusTotal</p> <p>FortiGate</p> <p>AWSCloudTrail</p> <p>ChatGPT</p>"},{"location":"Instrucitons/","title":"Instructions","text":"<p>Online install</p> <p>Local install</p> <p>RU language in Dashboard</p> <p>Dashhboard Update</p>"},{"location":"features/","title":"SCOPD SIEM \u2013 Features","text":"<p>SCOPD is a lightweight SIEM with custom integrations and enhancements.</p>"},{"location":"features/#core-features","title":"\ud83d\udd25 Core Features","text":"<ul> <li> <p>Log collection and analysis</p> <ul> <li>Syslog, agent-based, and file-based log ingestion</li> <li>Support for network devices, servers, and applications</li> </ul> </li> <li> <p>Threat detection and alerting</p> <ul> <li>Rule-based detection engine</li> <li>Severity-based alerts</li> <li>Real-time event correlation</li> </ul> </li> <li> <p>File Integrity Monitoring (FIM)</p> <ul> <li>Detects file creation, modification, and deletion</li> <li>Supports real-time and scheduled scans</li> </ul> </li> <li> <p>Vulnerability detection</p> <ul> <li>OS and package vulnerability scanning</li> <li>CVE-based detection using vendor feeds</li> </ul> </li> <li> <p>Security configuration assessment (SCA)</p> <ul> <li>Compliance checks against CIS, PCI DSS, HIPAA, and more</li> <li>Misconfiguration detection</li> </ul> </li> <li> <p>Rootkit and malware detection</p> <ul> <li>Rootkit scanning</li> <li>Suspicious binary detection</li> </ul> </li> <li> <p>Active response</p> <ul> <li>Automated actions on security events</li> <li>IP blocking, process termination, script execution</li> </ul> </li> <li> <p>MITRE ATT&amp;CK mapping</p> <ul> <li>Native MITRE technique and tactic mapping</li> <li>Improved threat visibility and reporting</li> </ul> </li> <li> <p>Centralized management</p> <ul> <li>Agent management at scale</li> <li>Central policy and configuration control</li> </ul> </li> </ul>"},{"location":"xdr/","title":"XDR","text":"<p>Detecting and removing malware using VirusTotal</p> <p>Blocking SSH brute-force attack with Active Response</p>"},{"location":"instructions/dashboard_updating/","title":"SIEM Dashboard Update","text":""},{"location":"instructions/dashboard_updating/#steps","title":"Steps","text":"<ol> <li> <p>Copy the dashboard <code>.deb</code> package to your machine.</p> </li> <li> <p>Back up the Dashboard config:</p> </li> </ol> <pre><code>sudo cp /etc/wazuh-dashboard/opensearch_dashboards.yml /etc/wazuh-dashboard/opensearch_dashboards.yml.bak\n</code></pre> <ol> <li>Stop the Wazuh Dashboard service:</li> </ol> <pre><code>sudo systemctl stop wazuh-dashboard\n</code></pre> <ol> <li>Reinstall the Dashboard package:</li> </ol> <pre><code>sudo dpkg -i /root/wazuh-dashboard_4.12.0-1_amd64.deb\n</code></pre> <ol> <li>Restore the config from backup:</li> </ol> <pre><code>sudo cp /etc/wazuh-dashboard/opensearch_dashboards.yml.bak /etc/wazuh-dashboard/opensearch_dashboards.yml\n</code></pre> <ol> <li>Start the service and check status:</li> </ol> <pre><code>sudo systemctl daemon-reload\nsudo systemctl start wazuh-dashboard\nsudo systemctl status --no-pager wazuh-dashboard\n</code></pre>"},{"location":"instructions/local_install/","title":"SCOPD SIEM Local Installation Guide","text":""},{"location":"instructions/local_install/#step-1-preparing-the-archive","title":"Step 1. Preparing the archive","text":"<p>Upload the archive to the server beforehand: <code>SCOPD SIEM local install.zip</code></p>"},{"location":"instructions/local_install/#step-2-connecting-to-the-server","title":"Step 2. Connecting to the server","text":"<p>On your computer:</p> <pre><code>ssh -p 3024 administrator@&lt;server-ip&gt;\n</code></pre> <p>Connect as user <code>administrator</code>.</p>"},{"location":"instructions/local_install/#step-3-extracting-the-archive","title":"Step 3. Extracting the archive","text":"<p>On the server:</p> <pre><code># Go to the administrator\u2019s home folder\ncd /home/administrator\n\n# Extract the archive\nunzip \"SCOPD SIEM local install.zip\" -d ~/scopd-siem-local-install\n\n# Check contents\nls -l ~/scopd-siem-local-install\n</code></pre> <p>Now the folder <code>~/scopd-siem-local-install</code> contains the installation files, including <code>local_install.sh</code>.</p> <p>Extraction requires the <code>unzip</code> package. If it\u2019s missing, install it:</p> <pre><code>sudo apt-get update &amp;&amp; sudo apt-get install -y unzip\n</code></pre>"},{"location":"instructions/local_install/#step-4-running-the-installer","title":"Step 4. Running the installer","text":"<p>Go into the folder and run the script:</p> <pre><code>cd ~/scopd-siem-local-install\nchmod +x local_install.sh\nsudo ./local_install.sh\n</code></pre>"},{"location":"instructions/local_install/#step-5-finishing-installation","title":"Step 5. Finishing installation","text":"<p>After the script completes, you will see: <code>SCOPD SIEM successfully installed (offline).</code></p> <p>Now the web interface is available at:</p> <pre><code>https://&lt;server-ip&gt;:443\n</code></pre> <p>Login credentials:</p> <ul> <li>User: <code>admin</code></li> <li>Password: generated by the script (shown at the end of installation)</li> </ul>"},{"location":"instructions/online_install/","title":"SCOPD SIEM Installation Guide","text":""},{"location":"instructions/online_install/#step-1-copy-the-installation-script-to-the-server","title":"Step 1. Copy the installation script to the server","text":"<p>Copy the installation script to the server:</p> <p><code>scopd-siem-install-online.sh</code></p> <p>(For example, using <code>scp</code>, <code>sftp</code>, or any other secure file transfer method.)</p>"},{"location":"instructions/online_install/#step-2-server-check-and-preparation-inside-ssh","title":"Step 2. Server check and preparation (inside SSH)","text":""},{"location":"instructions/online_install/#21-verify-if-the-installation-file-is-present","title":"2.1. Verify if the installation file is present","text":"<pre><code>ls -l ~/scopd-siem-install-online.sh\n</code></pre>"},{"location":"instructions/online_install/#22-firewall-configuration-open-required-ports","title":"2.2. Firewall configuration (open required ports)","text":"UFW configuration  If using UFW:  <pre><code>sudo ufw status    # check firewall state\n\n# if enabled \u2014 open required ports:\nsudo ufw allow 443/tcp      # Dashboard\nsudo ufw allow 9200/tcp     # Indexer (REST)\nsudo ufw allow 9300/tcp     # Indexer (cluster)\nsudo ufw allow 1514/udp     # Manager (syslog)\nsudo ufw allow 1514/tcp     # Manager (agent connection)\nsudo ufw allow 1515/tcp     # Manager (agent registration)\nsudo ufw allow 55000/tcp    # Manager (API)\nsudo ufw reload\n</code></pre> firewalld configuration (rare on Ubuntu)  If using firewalld (rare on Ubuntu):  <pre><code>if command -v firewall-cmd &gt;/dev/null; then\n  sudo firewall-cmd --add-port=443/tcp --add-port=9200/tcp --add-port=9300/tcp \\\n                    --add-port=1514/udp --add-port=1515/tcp --add-port=55000/tcp \\\n                    --permanent\n  sudo firewall-cmd --reload\nfi\n</code></pre>"},{"location":"instructions/online_install/#23-removing-old-wazuh-installations-if-any","title":"2.3. Removing old Wazuh installations (if any)","text":"<p>To avoid conflicts, clean up everything that might remain:</p> Stop services and remove old Wazuh components <pre><code># stop services\nsudo systemctl stop wazuh-manager wazuh-indexer wazuh-dashboard filebeat 2&gt;/dev/null || true\n\n# remove packages\nsudo apt-get purge -y wazuh-manager wazuh-indexer wazuh-dashboard filebeat 2&gt;/dev/null || true\nsudo apt-get autoremove -y || true\n\n# remove repositories and keys\nsudo rm -f /etc/apt/sources.list.d/wazuh*.list /usr/share/keyrings/wazuh*.gpg\n\n# remove directories and logs\nsudo rm -rf /var/ossec \\\n            /etc/wazuh-indexer /var/lib/wazuh-indexer /var/log/wazuh-indexer \\\n            /etc/wazuh-dashboard /usr/share/wazuh-dashboard /var/log/wazuh-dashboard \\\n            /etc/filebeat /var/lib/filebeat /var/log/filebeat\n\n# remove temporary installer folders\nsudo rm -rf ~/wazuh-custom-install /root/wazuh-custom-install\nsudo rm -f  ~/wazuh-install-files.tar /root/wazuh-install-files.tar\nsudo rm -f  /var/log/wazuh-install.log\n\n# (optional) remove forced IPv4 for apt, if it was enabled\nsudo rm -f /etc/apt/apt.conf.d/99force-ipv4\n\n# update package index\nsudo apt-get update -y\n</code></pre>"},{"location":"instructions/online_install/#step-3-running-the-installer","title":"Step 3. Running the installer","text":"<p>Make the script executable:</p> <pre><code>chmod +x ~/scopd-siem-install-online.sh\n</code></pre> <p>Run it:</p> <pre><code>sudo bash ~/scopd-siem-install-online.sh\n</code></pre>"},{"location":"instructions/rulang/","title":"RU Language in Dashboard SIEM","text":""},{"location":"instructions/rulang/#change-wazuh-dashboard-ui-language-to-english","title":"Change Wazuh Dashboard UI language to English","text":"<ol> <li>Open the config file:</li> </ol> <pre><code>sudo nano /etc/wazuh-dashboard/opensearch_dashboards.yml\n</code></pre> <ol> <li>Delete srting:</li> </ol> <pre><code>i18n.locale\n</code></pre> <ol> <li>Restart the dashboard:</li> </ol> <pre><code>sudo systemctl restart wazuh-dashboard\n</code></pre> <ol> <li>Done. The UI language will switch to English after the restart.</li> </ol>"},{"location":"integrations/AWS_CloudTrail/","title":"AWS CloudTrail integration with SCOPD SIEM","text":""},{"location":"integrations/AWS_CloudTrail/#1-create-an-aws-account","title":"1. Create an AWS account","text":"<ol> <li>Go to https://aws.amazon.com/</li> <li>Click Create an AWS Account.</li> <li> <p>Fill in:</p> </li> <li> <p>Email</p> </li> <li>Password</li> <li>Phone number</li> <li>Credit/debit card (required for Free Tier)</li> <li>After registration, log in to the AWS Console:    <code>console.aws.amazon.com</code></li> <li> <p>In the top-right corner choose a region \u2014 for example:</p> </li> <li> <p><code>eu-north-1</code> (Stockholm)</p> </li> </ol>"},{"location":"integrations/AWS_CloudTrail/#2-create-an-s3-bucket-for-cloudtrail-logs","title":"2. Create an S3 bucket for CloudTrail logs","text":"<ol> <li>In the AWS search bar at the top type S3 and open the service.</li> <li>Click Create bucket.</li> <li> <p>Fill in:</p> </li> <li> <p>Bucket name: <code>scopd-cloudtrail-logs-&lt;name&gt;</code></p> </li> <li>Region: the same region you selected above</li> <li>Keep public access blocked.</li> <li>Leave other settings as default.</li> <li>Done.</li> </ol>"},{"location":"integrations/AWS_CloudTrail/#3-configure-cloudtrail-to-send-logs-to-s3","title":"3. Configure CloudTrail to send logs to S3","text":"<ol> <li>In the AWS search bar type CloudTrail \u2192 open Trails.</li> <li>Click Create trail.</li> <li> <p>Fill in:</p> </li> <li> <p>Trail name: <code>scopd-cloudtrail-trail-&lt;name&gt;</code></p> </li> <li> <p>In Storage location choose:</p> </li> <li> <p>Use existing bucket \u2192 select your bucket (from the previous section).</p> </li> <li>Multi-region trail \u2014 you can keep it enabled.</li> <li>Log file SSE-KMS encryption \u2014 uncheck this option.</li> <li>Click Create trail.</li> </ol> <p>Now CloudTrail will store <code>.json.gz</code> files in your S3 bucket.</p>"},{"location":"integrations/AWS_CloudTrail/#4-create-an-iam-policy-for-siem","title":"4. Create an IAM policy for SIEM","text":"<p>SCOPD SIEM must have permissions to:</p> <ul> <li><code>s3:ListBucket</code></li> <li> <p><code>s3:GetObject</code></p> </li> <li> <p>Open IAM \u2192 Policies \u2192 Create policy.</p> </li> <li>Select the JSON tab.</li> <li>Paste the following:</li> </ul> Show IAM policy JSON <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\"s3:ListBucket\"],\n      \"Resource\": \"arn:aws:s3:::scopd-cloudtrail-logs-&lt;name&gt;\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\"s3:GetObject\"],\n      \"Resource\": \"arn:aws:s3:::scopd-cloudtrail-logs-&lt;name&gt;/*\"\n    }\n  ]\n}\n</code></pre> <ol> <li>Name the policy: <code>ScopdCloudTrailAccess</code></li> <li>Create the policy.</li> </ol>"},{"location":"integrations/AWS_CloudTrail/#5-create-an-iam-user-and-access-keys","title":"5. Create an IAM user and access keys","text":"<ol> <li>Go to IAM \u2192 Users \u2192 Create user.</li> <li>User name: <code>scopd-aws-reader</code></li> <li> <p>In Permissions choose Attach policies directly and attach:</p> </li> <li> <p><code>ScopdCloudTrailAccess</code></p> </li> <li>Finish user creation.</li> <li>On the user page, click Create access key.</li> </ol> <p>Save the Access key ID and Secret access key \u2014 you will need them later.</p>"},{"location":"integrations/AWS_CloudTrail/#6-configure-aws-credentials-on-the-siem-manager","title":"6. Configure AWS credentials on the SIEM Manager","text":"<p>On the SIEM server:</p> <pre><code>sudo su -\nmkdir -p /root/.aws\nnano /root/.aws/credentials\n</code></pre> <p>Paste:</p> <pre><code>[scopd-aws]\naws_access_key_id = &lt;your AccessKeyID&gt;\naws_secret_access_key = &lt;your SecretAccessKey&gt;\n</code></pre> <p>Save the file.</p> <p>Then create the config file:</p> <pre><code>nano /root/.aws/config\n</code></pre> <pre><code>[profile scopd-aws]\nregion = eu-north-1\noutput = json\n</code></pre>"},{"location":"integrations/AWS_CloudTrail/#7-install-aws-cli-optional-for-testing","title":"7. Install AWS CLI (optional, for testing)","text":"Installation commands for AWS CLI <pre><code>curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\nsudo ./aws/install\n</code></pre>  Verification:  <pre><code>/usr/local/bin/aws --version\n</code></pre>"},{"location":"integrations/AWS_CloudTrail/#8-test-the-aws-profile","title":"8. Test the AWS profile","text":"<pre><code>/usr/local/bin/aws sts get-caller-identity --profile scopd-aws\n</code></pre> <p>If you see <code>UserId</code> and <code>Arn</code> in the output, the profile works correctly.</p>"},{"location":"integrations/AWS_CloudTrail/#9-test-access-to-the-s3-bucket","title":"9. Test access to the S3 bucket","text":"<pre><code>/usr/local/bin/aws s3 ls s3://scopd-cloudtrail-logs-&lt;name&gt; --profile scopd-aws\n</code></pre> <p>If you see something like:</p> <pre><code>PRE AWSLogs/\n</code></pre> <p>\u2192 access to the bucket is working.</p>"},{"location":"integrations/AWS_CloudTrail/#10-configure-siem-for-aws-s3","title":"10. Configure SIEM for AWS S3","text":"<p>Open the SCOPD SIEM configuration:</p> <pre><code>nano /var/ossec/etc/ossec.conf\n</code></pre> <p>Add the following before <code>&lt;/ossec_config&gt;</code>:</p> aws-s3 wodle configuration <pre><code>&lt;wodle name=\"aws-s3\"&gt;\n  &lt;disabled&gt;no&lt;/disabled&gt;\n  &lt;interval&gt;30m&lt;/interval&gt;\n  &lt;run_on_start&gt;yes&lt;/run_on_start&gt;\n  &lt;skip_on_error&gt;no&lt;/skip_on_error&gt;\n  &lt;bucket type=\"cloudtrail\"&gt;\n    &lt;name&gt;wazuh-cloudtrail-logs-&lt;name&gt;&lt;/name&gt;\n    &lt;aws_profile&gt;scopd-aws&lt;/aws_profile&gt;\n  &lt;/bucket&gt;\n&lt;/wodle&gt;\n</code></pre> <p>Save the file.</p>"},{"location":"integrations/AWS_CloudTrail/#11-restart-siem-manager","title":"11. Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre>"},{"location":"integrations/AWS_CloudTrail/#12-check-wazuh-logs","title":"12. Check Wazuh logs","text":"<pre><code>sudo tail -f /var/ossec/logs/ossec.log | grep aws\n</code></pre> <p>Expected log lines:</p> <pre><code>INFO: Starting fetching of logs\nINFO: Executing Bucket Analysis\nINFO: Fetching logs finished\n</code></pre> <p>There should be no error messages.</p>"},{"location":"integrations/AWS_CloudTrail/#13-check-that-cloudtrail-events-appear","title":"13. Check that CloudTrail events appear","text":"<p>CloudTrail writes files to S3 with a delay of about 1\u20135 minutes. Check:</p> <pre><code>/usr/local/bin/aws s3 ls s3://scopd-cloudtrail-logs-&lt;name&gt;/AWSLogs/ --recursive --profile scopd-aws\n</code></pre> <p>If you see <code>.json.gz</code> files \u2192 SCOPD SIEM will process them.</p>"},{"location":"integrations/AWS_CloudTrail/#14-check-in-the-wazuh-dashboard","title":"14. Check in the Wazuh Dashboard","text":"<p>Open the Amazon Web Services section in the SIEM dashboard.</p> <p>Integration is complete \u2014 CloudTrail events are now ingested into SCOPD SIEM.</p>"},{"location":"integrations/chatgpt/","title":"ChatGPT Assistant Integration Guide","text":"<p>This guide explains how to enable and use the built-in ChatGPT assistant in the SCOPD SIEM dashboard.</p>"},{"location":"integrations/chatgpt/#1-open-the-chatgpt-assistant","title":"1. Open the ChatGPT assistant","text":"<ol> <li>In the dashboard, look at the bottom-right corner of the screen.</li> <li>Click the blue ChatGPT icon to open the assistant panel.</li> </ol>"},{"location":"integrations/chatgpt/#2-open-the-settings-menu","title":"2. Open the settings menu","text":"<ol> <li>In the opened assistant panel, click the gear (\u2699) icon at the top of the dropdown/menu.</li> <li>This opens the ChatGPT / OpenAI settings section.</li> </ol>"},{"location":"integrations/chatgpt/#3-enter-your-openai-api-token","title":"3. Enter your OpenAI API token","text":"<ol> <li>In the settings panel, find the field labeled something like OpenAI token / OpenAI API key.</li> <li> <p>Paste your OpenAI API token into this field.</p> </li> <li> <p>It usually looks like: <code>sk-...</code></p> </li> <li>Confirm/save the settings (for example, by clicking Save or closing the settings if they are auto-saved).</li> </ol> <p>After this, the assistant can use your own OpenAI account to answer queries.</p>"},{"location":"integrations/chatgpt/#4-using-the-chatgpt-assistant","title":"4. Using the ChatGPT assistant","text":"<p>Once the token is saved, you can start using the assistant:</p> <ul> <li>Type any question in the chat input at the bottom of the assistant panel.</li> <li> <p>You can ask about:</p> </li> <li> <p>SCOPD SIEM usage</p> </li> <li>SIEM configuration and rules</li> <li>general SIEM/SOC topics</li> <li>step-by-step instructions, troubleshooting, etc.</li> </ul>"},{"location":"integrations/chatgpt/#image-support","title":"Image support","text":"<p>\u26a0 Important: You can upload screenshots in two ways:</p> <ol> <li>Click the upload/attachment button in the chat and select an image file.</li> <li>Or simply paste from the clipboard (e.g. <code>Ctrl + V</code> after taking a screenshot).</li> </ol> <p>The assistant can analyze and recognize content on images (screenshots, error messages, dashboards, etc.).</p>"},{"location":"integrations/chatgpt/#5-choose-the-chatgpt-version","title":"5. Choose the ChatGPT version","text":"<p>At the top of the assistant panel, to the right of the label \u201cAI assistant\u201d, there is a dropdown with model versions.</p> <ol> <li>Click the dropdown to open the list of available ChatGPT versions.</li> <li>Select the version you want to use (for example, a \u201cfaster\u201d or a \u201cmore accurate\u201d model, depending on what is available in your setup).</li> </ol> <p>The selected version will be used for all subsequent replies until you change it.</p>"},{"location":"integrations/chatgpt/#6-handling-api-errors","title":"6. Handling API errors","text":"<p>If you get an error like <code>api error</code> when sending a request:</p> <ol> <li> <p>Check your token spelling:</p> </li> <li> <p>Make sure there are no extra spaces before or after the key.</p> </li> <li>Confirm you copied the full key (it should usually start with <code>sk-</code>).</li> <li> <p>Verify that:</p> </li> <li> <p>The token is still active in your OpenAI account.</p> </li> <li>The key has enough quota / billing is valid (if applicable).</li> </ol> <p>If the token is invalid or expired, replace it with a new one in the settings (gear icon \u2192 token field) and try again.</p>"},{"location":"integrations/dlp/","title":"SCOPD DLP Integration","text":""},{"location":"integrations/dlp/#enable-syslog-on-the-manager","title":"Enable Syslog on the Manager","text":"<p>Add the following configuration in between the <code>&lt;ossec_config&gt;</code> tags of the SIEM server <code>/var/ossec/etc/ossec.conf</code> file to listen for syslog messages on TCP port 514:</p> <pre><code>&lt;remote&gt;\n  &lt;connection&gt;syslog&lt;/connection&gt;\n  &lt;port&gt;514&lt;/port&gt;\n  &lt;protocol&gt;udp&lt;/protocol&gt;\n  &lt;allowed-ips&gt;any&lt;/allowed-ips&gt;\n&lt;/remote&gt;\n</code></pre> <p>This enables receiving syslog messages over UDP/514 from any source.</p>"},{"location":"integrations/dlp/#restart-siem-manager","title":"Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre> <ul> <li>Confirm the Syslog port is listening:</li> </ul> <pre><code>sudo ss -lunpt | grep 514\n</code></pre>"},{"location":"integrations/dlp/#dlp-configuration","title":"DLP configuration","text":"<ul> <li>In BOSS-Online open: Global settings \u2192 Complex settings \u2192 Syslog.</li> </ul> <p>Specify:</p> <p>udp://:514 <p>Where  is the public address of SIEM Manager (e.g., 45.136.16.242). <ul> <li>Tick the checkboxes: - Computer events - User events</li> </ul> <p>Save.</p> <ul> <li>Restart the DLP service on Windows (via services.msc, service stsrv or equivalent).</li> </ul>"},{"location":"integrations/dlp/#setting-up-siem-rules","title":"Setting up SIEM Rules","text":"<p>Put the following rule definition inside the <code>&lt;rules&gt;</code> section in <code>/var/ossec/etc/rules/scopd_rules.xml</code></p> <pre><code>&lt;group name=\"dlp,scopd,\"&gt;\n\n&lt;!-- Base rule (group all SCOPD DLP events) --&gt;\n  &lt;rule id=\"100099\" level=\"0\"&gt;\n    &lt;decoded_as&gt;dlp-syslog&lt;/decoded_as&gt;\n    &lt;description&gt;SCOPD DLP: Base group&lt;/description&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 100: \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0443\u0433\u0440\u043e\u0437 --&gt;\n  &lt;rule id=\"100100\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"100\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Threat list \u2014 forbidden application launched&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 101: \u0437\u0430\u043f\u0443\u0441\u043a \u0441\u0430\u0439\u0442\u0430 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0443\u0433\u0440\u043e\u0437 --&gt;\n  &lt;rule id=\"100101\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"101\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Threat list \u2014 forbidden website opened&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 102: \u0432\u0432\u043e\u0434 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0443\u0433\u0440\u043e\u0437 --&gt;\n  &lt;rule id=\"100102\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"102\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Threat list \u2014 forbidden text input detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 103: \u043f\u0435\u0447\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 --&gt;\n  &lt;rule id=\"100103\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"103\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Document print detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 104: \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 flash-\u0434\u0438\u0441\u043a --&gt;\n  &lt;rule id=\"100104\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"104\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Copy to USB flash drive detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 105: \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435 \u043f\u0430\u043f\u043a\u0438 --&gt;\n  &lt;rule id=\"100105\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"105\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Copy to monitored folders detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 106: \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0444\u0430\u0439\u043b\u0430 --&gt;\n  &lt;rule id=\"100106\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"106\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: File sent / transfer detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 107: \u0432\u0441\u0442\u0430\u0432\u043a\u0430 flash-\u0434\u0438\u0441\u043a\u0430 --&gt;\n  &lt;rule id=\"100107\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"107\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: USB flash drive inserted&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 108: \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 \u0431\u0443\u0444\u0435\u0440\u0435 \u043e\u0431\u043c\u0435\u043d\u0430 --&gt;\n  &lt;rule id=\"100108\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"108\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Clipboard image detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 109: DLP: \u0447\u0442\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 --&gt;\n  &lt;rule id=\"100109\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"109\"&lt;/match&gt;\n    &lt;description&gt;DLP: Document read detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 110: DLP: \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0432 \u0431\u0443\u0444\u0435\u0440\u0435 \u043e\u0431\u043c\u0435\u043d\u0430 --&gt;\n  &lt;rule id=\"100110\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"110\"&lt;/match&gt;\n    &lt;description&gt;DLP: Document copied to clipboard&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 111: DLP: \u0442\u0435\u043a\u0441\u0442 \u0432 \u0431\u0443\u0444\u0435\u0440\u0435 \u043e\u0431\u043c\u0435\u043d\u0430 --&gt;\n  &lt;rule id=\"100111\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"111\"&lt;/match&gt;\n    &lt;description&gt;DLP: Text copied to clipboard&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 112: DLP: \u0441\u043d\u0438\u043c\u043e\u043a \u044d\u043a\u0440\u0430\u043d\u0430 --&gt;\n  &lt;rule id=\"100112\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"112\"&lt;/match&gt;\n    &lt;description&gt;DLP: Screenshot taken&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 113: DLP: \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 flash-\u0434\u0438\u0441\u043a --&gt;\n  &lt;rule id=\"100113\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"113\"&lt;/match&gt;\n    &lt;description&gt;DLP: Copy to USB flash drive detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 114: DLP: \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435 \u043f\u0430\u043f\u043a\u0438 --&gt;\n  &lt;rule id=\"100114\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"114\"&lt;/match&gt;\n    &lt;description&gt;DLP: Copy to monitored folders detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 115: DLP: \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 --&gt;\n  &lt;rule id=\"100115\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"115\"&lt;/match&gt;\n    &lt;description&gt;DLP: Document sent / exfiltration attempt detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 116: DLP: \u0433\u043e\u043b\u043e\u0441 --&gt;\n  &lt;rule id=\"100116\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"116\"&lt;/match&gt;\n    &lt;description&gt;DLP: Voice/audio capture detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 117: \u043d\u0435\u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 --&gt;\n  &lt;rule id=\"100117\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"117\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Anomalous (non-typical) behavior detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 118: \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u044f/\u0441\u043e\u0444\u0442\u0430 --&gt;\n  &lt;rule id=\"100118\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"118\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Hardware/software change detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 119: \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 --&gt;\n  &lt;rule id=\"100119\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"119\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Potential client removal detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 120: \u043d\u0435\u0442 \u043b\u0438\u0446\u0430 \u043f\u0435\u0440\u0435\u0434 \u0432\u0435\u0431-\u043a\u0430\u043c\u0435\u0440\u043e\u0439 --&gt;\n  &lt;rule id=\"100120\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"120\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Webcam \u2014 no face detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 121: \u0447\u0443\u0436\u043e\u0435 \u043b\u0438\u0446\u043e \u043f\u0435\u0440\u0435\u0434 \u0432\u0435\u0431-\u043a\u0430\u043c\u0435\u0440\u043e\u0439 --&gt;\n  &lt;rule id=\"100121\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"121\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Webcam \u2014 unknown face detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 122: \u0431\u043e\u043b\u0435\u0435 1-\u0433\u043e \u043b\u0438\u0446\u0430 \u043f\u0435\u0440\u0435\u0434 \u0432\u0435\u0431-\u043a\u0430\u043c\u0435\u0440\u043e\u0439 --&gt;\n  &lt;rule id=\"100122\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"122\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Webcam \u2014 multiple faces detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 123: \u043e\u0442\u0441\u0440\u043e\u0447\u043a\u0430 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u041f\u041a --&gt;\n  &lt;rule id=\"100123\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"123\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: PC shutdown delay detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 124: \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435 --&gt;\n  &lt;rule id=\"100124\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"124\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Client issue detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 125: \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0430 --&gt;\n  &lt;rule id=\"100125\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"125\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Microphone state changed&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 126: \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435/\u0441\u0430\u0439\u0442 --&gt;\n  &lt;rule id=\"100126\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"126\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Critical application/website detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 127: \u0432\u0445\u043e\u0434 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 --&gt;\n  &lt;rule id=\"100127\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"127\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: User login detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 128: \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u0438\u0437 \u0447\u0435\u0440\u043d\u043e\u0433\u043e \u0441\u043f\u0438\u0441\u043a\u0430 --&gt;\n  &lt;rule id=\"100128\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"128\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Blacklist \u2014 forbidden application launched&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 129: DLP: \u043f\u0435\u0447\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 --&gt;\n  &lt;rule id=\"100129\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"129\"&lt;/match&gt;\n    &lt;description&gt;DLP: Document print detected&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 130: \u0437\u0430\u043f\u0443\u0441\u043a \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043d\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0435 Linux --&gt;\n  &lt;rule id=\"100130\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"130\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Linux terminal \u2014 forbidden command executed&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 131: USB-\u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e \u0431\u044b\u043b\u043e \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043e --&gt;\n  &lt;rule id=\"100131\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"131\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: USB device blocked&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 132: DLP: \u0444\u0430\u0439\u043b \u0432 \u043f\u0430\u043f\u043a\u0435 --&gt;\n  &lt;rule id=\"100132\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"132\"&lt;/match&gt;\n    &lt;description&gt;DLP: File detected in monitored folder&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n  &lt;!-- 133: \u043a\u0440\u0438\u043f\u0442\u043e-\u0430\u0434\u0440\u0435\u0441 \u0432 \u0431\u0443\u0444\u0435\u0440\u0435 \u043e\u0431\u043c\u0435\u043d\u0430 --&gt;\n  &lt;rule id=\"100133\" level=\"12\"&gt;\n    &lt;if_sid&gt;100099&lt;/if_sid&gt;\n    &lt;match&gt;event_type=\"133\"&lt;/match&gt;\n    &lt;description&gt;SCOPD: Cryptocurrency address detected in clipboard&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n\n&lt;/group&gt;\n</code></pre>"},{"location":"integrations/dlp/#restart-siem-manager_1","title":"Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre>"},{"location":"integrations/dlp/#alert-types","title":"Alert Types","text":"<ul> <li>100 \u2014 Threat list: application launched</li> <li>101 \u2014 Threat list: website opened</li> <li>102 \u2014 Threat list: text input detected</li> <li>103 \u2014 Document printed</li> <li>104 \u2014 Copied to USB flash drive</li> <li>105 \u2014 Copied to selected folders</li> <li>106 \u2014 File sent (transfer)</li> <li>107 \u2014 USB flash drive inserted</li> <li>108 \u2014 Clipboard: image detected</li> <li>109 \u2014 DLP: document read</li> <li>110 \u2014 DLP: document in clipboard</li> <li>111 \u2014 DLP: text in clipboard</li> <li>112 \u2014 DLP: screenshot taken</li> <li>113 \u2014 DLP: copied to USB flash drive</li> <li>114 \u2014 DLP: copied to selected folders</li> <li>115 \u2014 DLP: document sent</li> <li>116 \u2014 DLP: voice/audio detected</li> <li>117 \u2014 Anomalous behavior detected</li> <li>118 \u2014 Hardware/software change detected</li> <li>119 \u2014 Possible client removal detected</li> <li>120 \u2014 Webcam: no face detected</li> <li>121 \u2014 Webcam: unknown face detected</li> <li>122 \u2014 Webcam: multiple faces detected</li> <li>123 \u2014 PC shutdown delay detected</li> <li>124 \u2014 Client issue detected</li> <li>125 \u2014 Microphone state changed</li> <li>126 \u2014 Critical application/website detected</li> <li>127 \u2014 User login detected</li> <li>128 \u2014 Blacklist: application launched</li> <li>129 \u2014 DLP: document printed</li> <li>130 \u2014 Linux terminal: forbidden command executed</li> <li>131 \u2014 USB device blocked</li> <li>132 \u2014 DLP: file in folder detected</li> <li>133 \u2014 Clipboard: cryptocurrency address detected</li> </ul>"},{"location":"integrations/fortigate/","title":"FortiGate integration","text":""},{"location":"integrations/fortigate/#enable-syslog-on-the-manager","title":"Enable Syslog on the Manager","text":"<p>Add the following configuration in between the <code>&lt;ossec_config&gt;</code> tags of the SIEM server <code>/var/ossec/etc/ossec.conf</code> file to listen for syslog messages on TCP port 514:</p> <pre><code>&lt;remote&gt;\n  &lt;connection&gt;syslog&lt;/connection&gt;\n  &lt;port&gt;514&lt;/port&gt;\n  &lt;protocol&gt;udp&lt;/protocol&gt;\n  &lt;allowed-ips&gt;any&lt;/allowed-ips&gt;\n&lt;/remote&gt;\n</code></pre> <p>This enables receiving syslog messages over UDP/514 from any source.</p>"},{"location":"integrations/fortigate/#restart-siem-manager","title":"Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre> <ul> <li>Confirm the Syslog port is listening:</li> </ul> <pre><code>sudo ss -lunpt | grep 514\n</code></pre>"},{"location":"integrations/fortigate/#configure-syslogudp-forwarding-on-fortigate","title":"Configure Syslog/UDP forwarding on FortiGate","text":"<p>In the FortiGate web interface, go to:</p> <p>Log &amp; Report \u2192 Log Settings</p> <ol> <li>Enable Syslog.</li> <li>In the IP field, enter the IP address of your SIEM Manager.</li> </ol> <p>You don\u2019t need to change the port or protocol \u2014 FortiGate sends logs over UDP/514 by default.</p>"},{"location":"integrations/phishing/","title":"SCOPD Phishing attack simulator Integration","text":""},{"location":"integrations/phishing/#setting-up-siem-rules","title":"Setting up SIEM Rules","text":"<p>Put the following rule definition inside the <code>&lt;rules&gt;</code> section in <code>/var/ossec/etc/rules/scopd_rules.xml</code></p> <pre><code>&lt;group name=\"phishing,scopd,\"&gt;\n  &lt;rule id=\"100180\" level=\"12\"&gt;\n    &lt;decoded_as&gt;json&lt;/decoded_as&gt;\n    &lt;if_sid&gt;86600&lt;/if_sid&gt;\n    &lt;field name=\"event_type\"&gt;^phishing_link_click$&lt;/field&gt;\n    &lt;description&gt;Phishing Simulation: User clicked on a phishing link. Email: $(user_email)&lt;/description&gt;\n    &lt;options&gt;no_full_log&lt;/options&gt;\n  &lt;/rule&gt;\n&lt;/group&gt;\n</code></pre>"},{"location":"integrations/phishing/#restart-siem-manager","title":"Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre>"},{"location":"integrations/phishing/#the-phishing-simulator-agent","title":"The Phishing Simulator agent","text":"<p>!Attention! On this machine, you need both the SIEM agent installed and the Phishing Simulator client itself!</p> <ul> <li>Agent file: <code>/var/ossec/etc/ossec.conf</code></li> </ul> <p>Add one block: <pre><code>&lt;ossec_config&gt;\n\n  &lt;localfile&gt;\n\n    &lt;log_format&gt;syslog&lt;/log_format&gt;\n\n    &lt;location&gt;/var/log/syslog&lt;/location&gt;\n\n  &lt;/localfile&gt;\n\n&lt;/ossec_config&gt;\n</code></pre></p>"},{"location":"integrations/phishing/#restart-linux-agent","title":"Restart Linux Agent","text":"<pre><code>sudo systemctl restart wazuh-agent\n</code></pre>"},{"location":"integrations/virustotal/","title":"VirusTotal Integration","text":""},{"location":"integrations/virustotal/#siem-server-configuration","title":"SIEM server configuration","text":"<p>Perform the following step on the SIEM server to configure the VirusTotal integration. Add the following configuration within the <code>&lt;ossec_config&gt;</code> block of the <code>/var/ossec/etc/ossec.conf</code> file to enable the VirusTotal integration. Replace <code>{YOUR_API_KEY}</code> with your VirusTotal API key</p> <pre><code>&lt;integration&gt;\n\n  &lt;name&gt;virustotal&lt;/name&gt;\n\n  &lt;api_key&gt;{YOUR_API_KEY}&lt;/api_key&gt;&lt;!-- Replace with your API key --&gt;\n\n  &lt;group&gt;syscheck&lt;/group&gt;\n\n  &lt;alert_format&gt;json&lt;/alert_format&gt;\n\n&lt;/integration&gt;\n</code></pre>"},{"location":"integrations/virustotal/#define-monitored-folders-fim","title":"Define monitored folders (FIM)","text":"<p>Add the below entry within the <code>&lt;syscheck&gt;</code> block to monitor and alert files detected as malicious by VirusTotal.</p>"},{"location":"integrations/virustotal/#linux-example","title":"Linux example","text":"<p>file path <code>/var/ossec/etc/ossec.conf</code> <pre><code>&lt;directories check_all=\"yes\" realtime=\"yes\"&gt;/media/user/software&lt;/directories&gt;\n</code></pre></p>"},{"location":"integrations/virustotal/#windows-example","title":"Windows example:","text":"<p>file path <code>C:\\Program Files (x86)\\ossec-agent</code> <pre><code>&lt;directories check_all=\"yes\" realtime=\"yes\"&gt;C:\\Users\\Public\\Downloads&lt;/directories&gt;\n</code></pre></p>"},{"location":"integrations/virustotal/#restart-services","title":"Restart Services","text":"<p>Run the following commands as applicable:</p>"},{"location":"integrations/virustotal/#restart-siem-manager","title":"Restart SIEM Manager","text":"<pre><code>sudo systemctl restart wazuh-manager\n</code></pre>"},{"location":"integrations/virustotal/#restart-linux-agent","title":"Restart Linux Agent","text":"<pre><code>sudo systemctl restart wazuh-agent\n</code></pre>"},{"location":"integrations/virustotal/#restart-windows-agent","title":"Restart Windows Agent","text":"<p>Run the following command in PowerShell as Administrator: <pre><code>Restart-Service wazuh\n</code></pre></p> <p>Run the following commands:</p>"},{"location":"integrations/virustotal/#linux-testing","title":"Linux Testing","text":"<p>Create a test directory and download the EICAR test file to trigger File Integrity Monitoring (FIM) and VirusTotal enrichment.</p> <p>\u26a0\ufe0f Expected result: - FIM alert for file creation - VirusTotal enrichment alert</p> <p>Run the following commands on the Linux agent:</p> <pre><code>sudo mkdir -p /media/user/software\nsudo curl -Lo /media/user/software/suspicious-file.exe https://secure.eicar.org/eicar.com\n</code></pre>"},{"location":"integrations/virustotal/#windows-testing","title":"Windows Testing","text":"<p>Download the EICAR test file to trigger File Integrity Monitoring (FIM) and VirusTotal enrichment.</p> <p>\u26a0\ufe0f Expected result: - FIM alert for file creation - VirusTotal enrichment alert</p> <p>Run the following command in PowerShell as Administrator:</p> <pre><code>Invoke-WebRequest -Uri \"https://secure.eicar.org/eicar.com\" `\n  -OutFile \"C:\\Users\\Public\\Downloads\\eicar.com\"\n</code></pre>"},{"location":"xdr/blocking-ssh-brute-force-attack-with-active-response/","title":"Blocking ssh brute force attack with active response","text":""},{"location":"xdr/blocking-ssh-brute-force-attack-with-active-response/#siem-server-configuration","title":"SIEM server configuration","text":"<p>SIEM comes with a set of default scripts used in Active Response. These scripts are located in the <code>/var/ossec/active-response/bin/</code> directory on Linux/Unix endpoints. The firewall-drop active response script works with Linux/Unix operating systems. It uses iptables to block malicious IP addresses.</p> <p>1.) Open the SIEM server <code>/var/ossec/etc/ossec.conf</code> file and verify that a <code>&lt;command&gt;</code> block called firewall-drop with the following configuration is present within the <code>&lt;ossec_config&gt;</code> block:</p> Firewall drop active response command <pre><code>&lt;command&gt;\n  &lt;name&gt;firewall-drop&lt;/name&gt;\n  &lt;executable&gt;firewall-drop&lt;/executable&gt;\n  &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt;\n&lt;/command&gt;\n</code></pre> <p>The <code>&lt;command&gt;</code> block contains information about the action to be executed on the SIEM agent:</p> <ul> <li> <p><code>&lt;name&gt;</code>: Sets a name for the command. In this case, firewall-drop.</p> </li> <li> <p><code>&lt;executable&gt;</code>: Specifies the active response script or executable that must run upon a trigger. In this case, it\u2019s the firewall-drop executable.</p> </li> <li> <p><code>&lt;timeout_allowed&gt;</code>: Allows a timeout after a period of time. This tag is set to yes here, which represents a stateful active response.</p> </li> </ul> Custom script option Note You can create your own custom script to block an IP address or perform any other action.  <p>2.) Add the  block below to the SIEM server <code>/var/ossec/etc/ossec.conf</code> configuration file: Active response configuration <pre><code>&lt;ossec_config&gt;\n  &lt;active-response&gt;\n    &lt;disabled&gt;no&lt;/disabled&gt;\n    &lt;command&gt;firewall-drop&lt;/command&gt;\n    &lt;location&gt;local&lt;/location&gt;\n    &lt;rules_id&gt;5763&lt;/rules_id&gt;\n    &lt;timeout&gt;180&lt;/timeout&gt;\n  &lt;/active-response&gt;\n&lt;/ossec_config&gt;\n</code></pre> <ul> <li> <p><code>&lt;command&gt;</code>: Specifies the command to configure. This is the command name firewall-drop defined in the previous step.</p> </li> <li> <p><code>&lt;location&gt;</code>: Specifies where the command executes. Using the local value means that the command executes on the monitored endpoint where the trigger event occurs.</p> </li> <li> <p><code>&lt;rules_id&gt;</code>: The Active Response module executes the command if rule ID 5763 - SSHD brute force trying to get access to the system fires.</p> </li> <li> <p><code>&lt;timeout&gt;</code>: Specifies how long the active response action must last. In this use case, the module blocks for 180 seconds the IP address of the endpoint carrying out the brute-force attack.</p> </li> <li> <p>Restart the SIEM manager service to apply the changes:</p> </li> </ul> <pre><code>sudo systemctl restart wazuh-manager\n</code></pre>"},{"location":"xdr/blocking-ssh-brute-force-attack-with-active-response/#test-the-configuration","title":"Test the configuration","text":"<p>Perform the steps below to perform an SSH brute-force attack against the RHEL endpoint.</p> <p>1.) Ping the RHEL endpoint from the Ubuntu endpoint to confirm there is network connectivity between the attacker and the victim endpoints:</p> <pre><code>ping &lt;RHEL_IP&gt;\n</code></pre> <p>Output</p> <pre><code>PING &lt;RHEL_IP&gt; (&lt;RHEL_IP&gt;) 56(84) bytes of data.\n64 bytes from &lt;RHEL_IP&gt;: icmp_seq=1 ttl=64 time=0.602 ms\n64 bytes from &lt;RHEL_IP&gt;: icmp_seq=2 ttl=64 time=0.774 ms\n</code></pre> <p>2.) On the Ubuntu endpoint, install Hydra. You need Hydra to execute the brute-force attack:</p> <pre><code>sudo apt update &amp;&amp; sudo apt install -y hydra\n</code></pre> <p>3.) On the Ubuntu endpoint, create a text file with 10 random passwords.</p> <p>4.) Run Hydra from the Ubuntu endpoint to execute brute-force attacks against the RHEL endpoint using the command below. Replace <code>&lt;RHEL_USERNAME&gt;</code> with the username of the RHEL endpoint, <code>&lt;PASSWD_LIST.txt&gt;</code> with the path to the passwords file created in the previous step, and <code>&lt;RHEL_IP&gt;</code> with the IP address of the RHEL endpoint:</p> <pre><code>sudo hydra -t 4 -l &lt;RHEL_USERNAME&gt; -P &lt;PASSWD_LIST.txt&gt; &lt;RHEL_IP&gt; ssh\n</code></pre> <p>Once the attack ends, you can see on the SIEM dashboard that rule ID 5763 fired.</p> <p>5.) Ping the victim endpoint from the attacker within 3 minutes of the attack execution to verify that the Active Response module has blocked the attacker's IP address:</p> <pre><code>ping &lt;RHEL_IP&gt;\n</code></pre> <p>Output</p> <pre><code>PING 10.0.0.5 (10.0.0.5) 56(84) bytes of data.\n^C\n--- 10.0.0.5 ping statistics ---\n12 packets transmitted, 0 received, 100% packet loss, time 11000ms\n</code></pre>"},{"location":"xdr/blocking-ssh-brute-force-attack-with-active-response/#firing-active-response","title":"Firing active response","text":"<p>Monitored Linux/Unix endpoints have a log file at <code>/var/ossec/logs/active-responses.log</code> where SIEM registers the active response activities. By default, the SIEM server monitors the Active Response log file. You can find the relevant section in the SIEM server <code>/var/ossec/etc/ossec.conf</code> configuration file as shown below:</p> Active response log monitoring configuration <pre><code>&lt;localfile&gt;\n  &lt;log_format&gt;syslog&lt;/log_format&gt;\n  &lt;location&gt;/var/ossec/logs/active-responses.log&lt;/location&gt;\n&lt;/localfile&gt;\n</code></pre> <p>When the active response triggers, a corresponding alert appears on the SIEM dashboard.</p> <p>The alert appears because rule ID 651 is part of the default <code>/var/ossec/ruleset/rules/0015-ossec_rules.xml</code> rule file on the SIEM server. If you create a custom active response script, you must add a proper custom rule to analyze the Active Response logs that are generated.</p>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/","title":"Detecting and removing malware using Virustotal","text":""},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#ubuntu-endpoint","title":"Ubuntu endpoint","text":""},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#agent-configuration","title":"Agent configuration","text":"<p>1.) Search for the <code>&lt;syscheck&gt;</code> block in the agent configuration file <code>/var/ossec/etc/ossec.conf</code>. Make sure that <code>&lt;disabled&gt;</code> is set to <code>no</code>. This enables monitoring for directory changes. - Add an entry within the <code>&lt;syscheck&gt;</code> block to configure a directory to be monitored in near real-time. In this case, you are monitoring the <code>/root</code> directory:</p> <p><code>&lt;directories realtime=\"yes\"&gt;/root&lt;/directories&gt;</code></p> <p>2.) Install <code>jq</code>, a utility that processes JSON input from the active response script.</p> <p>sudo apt update</p> <p>sudo apt -y install jq</p> <p>3.) Create the <code>/var/ossec/active-response/bin/remove-threat.sh</code> active response script to remove malicious files from the endpoint:</p> Active response script: remove-threat (Linux) <pre><code>#!/bin/bash\n\nLOCAL=`dirname $0`;\ncd $LOCAL\ncd ../\n\nPWD=`pwd`\n\nread INPUT_JSON\nFILENAME=$(echo $INPUT_JSON | jq -r .parameters.alert.data.virustotal.source.file)\nCOMMAND=$(echo $INPUT_JSON | jq -r .command)\nLOG_FILE=\"${PWD}/../logs/active-responses.log\"\n\n#------------------------ Analyze command -------------------------#\nif [ ${COMMAND} = \"add\" ]\nthen\n# Send control message to execd\nprintf '{\"version\":1,\"origin\":{\"name\":\"remove-threat\",\"module\":\"active-response\"},\"command\":\"check_keys\", \"parameters\":{\"keys\":[]}}\\n'\n\nread RESPONSE\nCOMMAND2=$(echo $RESPONSE | jq -r .command)\nif [ ${COMMAND2} != \"continue\" ]\nthen\necho \"`date '+%Y/%m/%d %H:%M:%S'` $0: $INPUT_JSON Remove threat active response aborted\" &gt;&gt; ${LOG_FILE}\nexit 0;\nfi\nfi\n\n# Removing file\nrm -f $FILENAME\nif [ $? -eq 0 ]; then\necho \"`date '+%Y/%m/%d %H:%M:%S'` $0: $INPUT_JSON Successfully removed threat\" &gt;&gt; ${LOG_FILE}\nelse\necho \"`date '+%Y/%m/%d %H:%M:%S'` $0: $INPUT_JSON Error removing threat\" &gt;&gt; ${LOG_FILE}\nfi\n\nexit 0;\n</code></pre> <p>4.) Change the <code>/var/ossec/active-response/bin/remove-threat.sh</code> file ownership, and permissions:</p> <p>sudo chmod 750 /var/ossec/active-response/bin/remove-threat.sh</p> <p>sudo chown root:wazuh /var/ossec/active-response/bin/remove-threat.sh</p> <p>5.) Restart the agent to apply the changes:</p> <p>sudo systemctl restart wazuh-agent</p>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#server-configuration","title":"Server configuration","text":"<p>1.) Add the following rules to the <code>/var/ossec/etc/rules/local_rules.xml</code> file on the SIEM server. These rules alert about changes in the <code>/root</code> directory that are detected by FIM scans:</p> FIM rules for detecting file changes in /root <pre><code>&lt;group name=\"syscheck,pci_dss_11.5,nist_800_53_SI.7,\"&gt;\n  &lt;!-- Rules for Linux systems --&gt;\n  &lt;rule id=\"100200\" level=\"7\"&gt;\n      &lt;if_sid&gt;550&lt;/if_sid&gt;\n      &lt;field name=\"file\"&gt;/root&lt;/field&gt;\n      &lt;description&gt;File modified in /root directory.&lt;/description&gt;\n  &lt;/rule&gt;\n  &lt;rule id=\"100201\" level=\"7\"&gt;\n      &lt;if_sid&gt;554&lt;/if_sid&gt;\n      &lt;field name=\"file\"&gt;/root&lt;/field&gt;\n      &lt;description&gt;File added to /root directory.&lt;/description&gt;\n  &lt;/rule&gt;\n&lt;/group&gt;\n</code></pre> <p>2.) Add the following configuration to the SIEM server <code>/var/ossec/etc/ossec.conf</code> file to enable the Virustotal integration. Replace <code>&lt;YOUR_VIRUS_TOTAL_API_KEY&gt;</code> with your VirusTotal API key. This allows to trigger a VirusTotal query whenever any of the rules 100200 and 100201 are triggered:</p> VirusTotal integration configuration (Linux) <pre><code>&lt;ossec_config&gt;\n&lt;integration&gt;\n  &lt;name&gt;virustotal&lt;/name&gt;\n  &lt;api_key&gt;{YOUR_VIRUS_TOTAL_API_KEY}&lt;/api_key&gt; &lt;!-- Replace with your VirusTotal API key --&gt;\n  &lt;rule_id&gt;100200,100201&lt;/rule_id&gt;\n  &lt;alert_format&gt;json&lt;/alert_format&gt;\n&lt;/integration&gt;\n&lt;/ossec_config&gt;\n</code></pre> Important: VirusTotal API rate limits The free VirusTotal API rate limits requests to four per minute. If you have a premium VirusTotal API key, with a high frequency of queries allowed, you can add more rules besides these two. You can also configure SIEM to monitor more directories.  <p>3.) Append the following blocks to the SIEM server <code>/var/ossec/etc/ossec.conf</code> file. This enables Active Response and triggers the remove-threat.sh script when VirusTotal flags a file as malicious:</p> Configure Active Response to remove malicious files <pre><code>&lt;ossec_config&gt;\n    &lt;command&gt;\n      &lt;name&gt;remove-threat&lt;/name&gt;\n      &lt;executable&gt;remove-threat.sh&lt;/executable&gt;\n      &lt;timeout_allowed&gt;no&lt;/timeout_allowed&gt;\n    &lt;/command&gt;\n\n    &lt;active-response&gt;\n      &lt;disabled&gt;no&lt;/disabled&gt;\n      &lt;command&gt;remove-threat&lt;/command&gt;\n      &lt;location&gt;local&lt;/location&gt;\n      &lt;rules_id&gt;87105&lt;/rules_id&gt;\n    &lt;/active-response&gt;\n&lt;/ossec_config&gt;\n</code></pre> <p>4.) Add the following rules to the SIEM server <code>/var/ossec/etc/rules/local_rules.xml</code> file to alert about the Active Response results:</p> Rules for Active Response execution results <pre><code>&lt;group name=\"virustotal,\"&gt;\n    &lt;rule id=\"100092\" level=\"12\"&gt;\n      &lt;if_sid&gt;657&lt;/if_sid&gt;\n      &lt;match&gt;Successfully removed threat&lt;/match&gt;\n      &lt;description&gt;$(parameters.program) removed threat located at $(parameters.alert.data.virustotal.source.file)&lt;/description&gt;\n    &lt;/rule&gt;\n\n    &lt;rule id=\"100093\" level=\"12\"&gt;\n      &lt;if_sid&gt;657&lt;/if_sid&gt;\n      &lt;match&gt;Error removing threat&lt;/match&gt;\n      &lt;description&gt;Error removing threat located at $(parameters.alert.data.virustotal.source.file)&lt;/description&gt;\n    &lt;/rule&gt;\n&lt;/group&gt;\n</code></pre> <p>5.) Restart the SIEM manager to apply the configuration changes:</p> <p>sudo systemctl restart wazuh-manager</p>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#attack-emulation","title":"Attack emulation","text":"<p>1.) Download an EICAR test file to the /root directory on the Ubuntu endpoint:</p> <p>sudo curl -Lo /root/eicar.com https://secure.eicar.org/eicar.com &amp;&amp; sudo ls -lah /root/eicar.com</p> <p>Visualize the alerts.</p> <p>You can visualize the alert data in the SIEM dashboard. To do this, go to the Threat Hunting module and add the filters in the search bar to query the alerts.</p> <ul> <li>Linux - rule.id: is one of 553,100092,87105,100201</li> </ul>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#windows-endpoint","title":"Windows endpoint","text":""},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#agent-configuration_1","title":"Agent configuration","text":"<p>Perform the following steps to configure SIEM to monitor near real-time changes in the <code>/Downloads</code> directory. These steps also install the necessary packages and create the active response script to remove malicious files.</p> <p>1.) Search for the <code>&lt;syscheck&gt;</code> block in the SIEM agent <code>C:\\Program Files (x86)\\ossec-agent\\ossec.conf</code> file. Make sure that  is set to no. This enables the SIEM FIM module to monitor for directory changes. <p>2.) Add an entry within the <code>&lt;syscheck&gt;</code> block to configure a directory to be monitored in near real-time. In this use case, you configure SIEM to monitor the <code>C:\\Users&lt;USER_NAME&gt;\\Downloads</code> directory. Replace the <code>&lt;USER_NAME&gt;</code> variable with the appropriate user name:</p> <pre><code>&lt;directories realtime=\"yes\"&gt;C:\\Users\\{USER_NAME}\\Downloads&lt;/directories&gt;\n</code></pre> <p>3.) Download the Python executable installer from the official Python website</p> <p>4.) Run the Python installer once downloaded. Make sure to check the following boxes:</p> <ul> <li>Install launcher for all users</li> <li>Add Python 3.X to PATH (This places the interpreter in the execution path)</li> </ul> <p>5.) Once Python completes the installation process, open an administrator PowerShell terminal and use pip to install PyInstaller:</p> <p>pip install pyinstaller</p> <p>pyinstaller --version</p> <p>You use Pyinstaller here to convert the active response Python script into an executable application that can run on a Windows endpoint.</p> <p>6.) Create an active response script remove-threat.py to remove a file from the Windows endpoint:</p> Warning: Proof-of-concept script This script is a proof of concept (PoC). Review and validate it to ensure it meets the operational and security requirements of your environment.  Active response script: remove-threat (Windows) <pre><code>import os\nimport sys\nimport json\nimport datetime\nimport stat\nimport tempfile\nimport pathlib\n\nif os.name == 'nt':\n  LOG_FILE = \"C:\\\\Program Files (x86)\\\\ossec-agent\\\\active-response\\\\active-responses.log\"\nelse:\n  LOG_FILE = \"/var/ossec/logs/active-responses.log\"\n\nADD_COMMAND = 0\nDELETE_COMMAND = 1\nCONTINUE_COMMAND = 2\nABORT_COMMAND = 3\n\nOS_SUCCESS = 0\nOS_INVALID = -1\n\nclass message:\n  def __init__(self):\n      self.alert = \"\"\n      self.command = 0\n\ndef write_debug_file(ar_name, msg):\n  with open(LOG_FILE, mode=\"a\") as log_file:\n      log_file.write(str(datetime.datetime.now().strftime('%Y/%m/%d %H:%M:%S')) + \" \" + ar_name + \": \" + msg +\"\\n\")\n\ndef setup_and_check_message(argv):\n  input_str = \"\"\n  for line in sys.stdin:\n      input_str = line\n      break\n\n  msg_obj = message()\n  try:\n      data = json.loads(input_str)\n  except ValueError:\n      write_debug_file(argv[0], 'Decoding JSON has failed, invalid input format')\n      msg_obj.command = OS_INVALID\n      return msg_obj\n\n  msg_obj.alert = data\n  command = data.get(\"command\")\n\n  if command == \"add\":\n      msg_obj.command = ADD_COMMAND\n  elif command == \"delete\":\n      msg_obj.command = DELETE_COMMAND\n  else:\n      msg_obj.command = OS_INVALID\n      write_debug_file(argv[0], 'Not valid command: ' + command)\n\n  return msg_obj\n\ndef send_keys_and_check_message(argv, keys):\n  keys_msg = json.dumps({\"version\": 1,\"origin\":{\"name\": argv[0],\"module\":\"active-response\"},\"command\":\"check_keys\",\"parameters\":{\"keys\":keys}})\n  write_debug_file(argv[0], keys_msg)\n\n  print(keys_msg)\n  sys.stdout.flush()\n\n  input_str = \"\"\n  while True:\n      line = sys.stdin.readline()\n      if line:\n          input_str = line\n          break\n\n  try:\n      data = json.loads(input_str)\n  except ValueError:\n      write_debug_file(argv[0], 'Decoding JSON has failed, invalid input format')\n      return OS_INVALID\n\n  action = data.get(\"command\")\n  if action == \"continue\":\n      return CONTINUE_COMMAND\n  elif action == \"abort\":\n      return ABORT_COMMAND\n  else:\n      write_debug_file(argv[0], \"Invalid value of 'command'\")\n      return OS_INVALID\n\ndef secure_delete_file(filepath_str, ar_name):\n  filepath = pathlib.Path(filepath_str)\n\n  # Reject NTFS alternate data streams\n  if '::' in filepath_str:\n      raise Exception(f\"Refusing to delete ADS or NTFS stream: {filepath_str}\")\n\n  # Reject symbolic links and reparse points\n  if os.path.islink(filepath):\n      raise Exception(f\"Refusing to delete symbolic link: {filepath}\")\n\n  attrs = os.lstat(filepath).st_file_attributes\n  if attrs &amp; stat.FILE_ATTRIBUTE_REPARSE_POINT:\n      raise Exception(f\"Refusing to delete reparse point: {filepath}\")\n\n  resolved_filepath = filepath.resolve()\n\n  # Ensure it's a regular file\n  if not resolved_filepath.is_file():\n      raise Exception(f\"Target is not a regular file: {resolved_filepath}\")\n\n# Perform deletion\n  os.remove(resolved_filepath)\n\ndef main(argv):\n  write_debug_file(argv[0], \"Started\")\n  msg = setup_and_check_message(argv)\n\n  if msg.command &lt; 0:\n      sys.exit(OS_INVALID)\n\n  if msg.command == ADD_COMMAND:\n      alert = msg.alert[\"parameters\"][\"alert\"]\n      keys = [alert[\"rule\"][\"id\"]]\n      action = send_keys_and_check_message(argv, keys)\n\n      if action != CONTINUE_COMMAND:\n          if action == ABORT_COMMAND:\n              write_debug_file(argv[0], \"Aborted\")\n              sys.exit(OS_SUCCESS)\n          else:\n              write_debug_file(argv[0], \"Invalid command\")\n              sys.exit(OS_INVALID)\n\n      try:\n          file_path = alert[\"data\"][\"virustotal\"][\"source\"][\"file\"]\n          if os.path.exists(file_path):\n              secure_delete_file(file_path, argv[0])\n              write_debug_file(argv[0], json.dumps(msg.alert) + \" Successfully removed threat\")\n          else:\n              write_debug_file(argv[0], f\"File does not exist: {file_path}\")\n      except OSError as error:\n          write_debug_file(argv[0], json.dumps(msg.alert) + \"Error removing threat\")\n      except Exception as e:\n          write_debug_file(argv[0], f\"{json.dumps(msg.alert)}: Error removing threat: {str(e)}\")\n  else:\n      write_debug_file(argv[0], \"Invalid command\")\n\n  write_debug_file(argv[0], \"Ended\")\n  sys.exit(OS_SUCCESS)\n\nif __name__ == \"__main__\":\n  main(sys.argv)\n</code></pre> <p>7.) Convert the active response Python script remove-threat.py to a Windows executable application. Run the following PowerShell command as an administrator to create the executable:</p> <p>pyinstaller -F \\path_to_remove-threat.py</p> <p>Take note of the path where pyinstaller created remove-threat.exe.</p> <p>8.) Move the executable file remove-threat.exe to the C:\\Program Files (x86)\\ossec-agent\\active-response\\bin directory.</p> <p>9.) Restart the SIEM agent to apply the changes. Run the following PowerShell command as an administrator:</p> <pre><code>&gt; Restart-Service -Name wazuh\n</code></pre>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#server-configuration_1","title":"Server configuration","text":"<p>Perform the following steps on the SIEM server to configure the VirusTotal integration. These steps also enable and trigger the active response script whenever a suspicious file is detected.</p> <p>1.) Add the following configuration to the <code>/var/ossec/etc/ossec.conf</code> file on the SIEM server to enable the VirusTotal integration. Replace <code>&lt;YOUR_VIRUS_TOTAL_API_KEY&gt;</code> with your VirusTotal API key. This allows to trigger a VirusTotal query whenever any of the rules in the FIM syscheck group are triggered:</p> VirusTotal integration configuration (Windows) <pre><code>&lt;ossec_config&gt;\n    &lt;integration&gt;\n      &lt;name&gt;virustotal&lt;/name&gt;\n      &lt;api_key&gt;{YOUR_VIRUS_TOTAL_API_KEY}&lt;/api_key&gt; &lt;!-- Replace with your VirusTotal API key --&gt;\n      &lt;group&gt;syscheck&lt;/group&gt;\n      &lt;alert_format&gt;json&lt;/alert_format&gt;\n    &lt;/integration&gt;\n&lt;/ossec_config&gt;\n</code></pre> Important: VirusTotal API rate limits The free VirusTotal API rate limits requests to four per minute. If you have a premium VirusTotal API key, with a high frequency of queries allowed, you can add more rules besides these two. You can configure SIEM to monitor more directories.  <p>2.) Append the following blocks to the SIEM server <code>/var/ossec/etc/ossec.conf</code> file. This enables Active Response and trigger the remove-threat.exe executable when the VirusTotal query returns positive matches for threats:</p> Configure Active Response to execute remove-threat.exe <pre><code>&lt;ossec_config&gt;\n    &lt;command&gt;\n      &lt;name&gt;remove-threat&lt;/name&gt;\n      &lt;executable&gt;remove-threat.exe&lt;/executable&gt;\n      &lt;timeout_allowed&gt;no&lt;/timeout_allowed&gt;\n    &lt;/command&gt;\n\n    &lt;active-response&gt;\n      &lt;disabled&gt;no&lt;/disabled&gt;\n      &lt;command&gt;remove-threat&lt;/command&gt;\n      &lt;location&gt;local&lt;/location&gt;\n      &lt;rules_id&gt;87105&lt;/rules_id&gt;\n    &lt;/active-response&gt;\n&lt;/ossec_config&gt;\n</code></pre> <p>3.) Add the following rules to the SIEM server <code>/var/ossec/etc/rules/local_rules.xml</code> file to alert about the Active Response results.</p> Rules for Active Response execution results <pre><code>&lt;group name=\"virustotal,\"&gt;\n    &lt;rule id=\"100092\" level=\"12\"&gt;\n        &lt;if_sid&gt;657&lt;/if_sid&gt;\n        &lt;match&gt;Successfully removed threat&lt;/match&gt;\n        &lt;description&gt;$(parameters.program) removed threat located at $(parameters.alert.data.virustotal.source.file)&lt;/description&gt;\n    &lt;/rule&gt;\n\n    &lt;rule id=\"100093\" level=\"12\"&gt;\n      &lt;if_sid&gt;657&lt;/if_sid&gt;\n      &lt;match&gt;Error removing threat&lt;/match&gt;\n      &lt;description&gt;Error removing threat located at $(parameters.alert.data.virustotal.source.file)&lt;/description&gt;\n    &lt;/rule&gt;\n&lt;/group&gt;\n</code></pre> <p>4.) Restart the SIEM manager to apply the configuration changes:</p> <p>sudo systemctl restart wazuh-manager</p>"},{"location":"xdr/detecting-and-removing-malware-using-virustotal/#attack-emulation_1","title":"Attack emulation","text":"<p>1.) Follow the next steps to temporarily turn off real-time Microsoft Defender antivirus protection in Windows Security:</p> <p>a. Click on the Start menu and type Windows Security to search for that app.</p> <p>b. Select the Windows Security app from results, go to Virus &amp; threat protection, and under Virus &amp; threat protection settings select Manage settings.</p> <p>c. Switch Real-time protection to Off.</p> <p>2.) Download an EICAR test file to the <code>C:\\Users&lt;USER_NAME&gt;\\Downloads</code> directory on the Windows endpoint.</p> <pre><code>Invoke-WebRequest -Uri [https://secure.eicar.org/eicar.com.txt](https://secure.eicar.org/eicar.com.txt) -OutFile eicar.txt\ncp .\\eicar.txt C:\\Users&lt;USER_NAME&gt;\\Downloads\n</code></pre> <p>This triggers a VirusTotal query and generates an alert. In addition, the active response script automatically removes the file.</p> <p>You can visualize the alert data in the SIEM dashboard. To do this, go to the Threat Hunting module and add the filters in the search bar to query the alerts.</p> <ul> <li>Windows - rule.id: is one of 554,100092,553,87105</li> </ul>"}]}